# autoemlbuilder

This repository contains a simple tool for generating `.eml` email files from a text template and an Excel spreadsheet of recipients.

## Usage
1. Prepare the following files and folders in the project directory:
   - `email_template.txt` – email body template with placeholders such as `[FirstName]`.
   - `recipients.xlsx` – spreadsheet with columns matching the placeholders. An `Email` column is required. Optional columns may include `Attachment1`, `Attachment2`, etc.
   - `attachments/` – folder containing any files referenced in the spreadsheet.
   - `generated_emails/` – (created automatically) where `.eml` files will be saved.
   - `conditional_lines.json` – (optional) a JSON file defining lines to be added to the email body based on Excel columns.

### Excel columns

The spreadsheet can contain the following columns:

| Column name        | Required | Description                                                                                   |
|--------------------|----------|-----------------------------------------------------------------------------------------------|
| `Email` or `To`    | Yes      | Primary recipient address(es). Use comma-separated values for multiple recipients.            |
| `CC`               | No       | Carbon copy recipient address(es). Use comma-separated values for multiple recipients.        |
| `BCC`              | No       | Blind carbon copy recipient address(es). Use comma-separated values for multiple recipients.  |
| `From`             | No       | Sender address. Defaults to `sender@example.com` if omitted.                                   |
| `Subject`          | No       | Email subject. Defaults to `No Subject`.                                                       |
| `FirstName`        | No       | Used to build the output file name and available as a template variable.                      |
| `Attachment*`      | No       | Any columns beginning with `Attachment` are treated as filenames to attach to the message.     |
| Other placeholders | No       | Additional columns with names matching placeholders in `email_template.txt` (e.g. `LastName`). |
| *Custom flags*     | No       | Columns matching keys in `conditional_lines.json`. Set the value to `1` to include the line. |

### Conditional Content

You can add specific lines to the email body based on flags in your Excel file. This is useful for including optional paragraphs, like a special offer or a meeting reminder.

1.  **Create `conditional_lines.json`:**
    In your project directory, create a file named `conditional_lines.json`. This file contains a dictionary where each key is a column name you'll use in Excel, and the value is the line of text to add.

    **Example `conditional_lines.json`:**
    ```json
    {
      "SpecialOffer": "As a valued customer, we would like to offer you a special discount of [Discount]%.",
      "MeetingReminder": "This is a friendly reminder about our meeting scheduled for [MeetingDate]."
    }
    ```

2.  **Add Flags to Excel:**
    In your `recipients.xlsx` file, add columns with names that exactly match the keys from your JSON file (e.g., `SpecialOffer`). To include the conditional line for a specific recipient, set the cell value to `1`.

    **Example Excel data:**
    | Email | FirstName | SpecialOffer | MeetingReminder | Discount | MeetingDate |
    |-------|-----------|--------------|-----------------|----------|-------------|
    | john@example.com | John | 1 | 0 | 15 | 2025-07-15 |
    | jane@example.com | Jane | 0 | 1 | | 2025-07-18 |
    | alice@company.com| Alice | 1 | 1 | 20 | 2025-07-20 |

3.  **Result:**
    - **John's email** will include the "SpecialOffer" line with the discount filled in.
    - **Jane's email** will include the "MeetingReminder" line.
    - **Alice's email** will include both lines.

The script will automatically detect `conditional_lines.json` and process these flags.

#### Controlling Position (Granular)

To place each conditional line in a specific location within your email, use placeholders in the format `[Conditional:Key]` inside your `email_template.txt`. The `Key` must exactly match a key from your `conditional_lines.json` file.

**Example `email_template.txt`:**
```
Hi [FirstName],

[Conditional:SpecialOffer]

We are looking forward to our meeting.
[Conditional:MeetingReminder]

Thank you,
The Team
```

**How it Works:**
- The script finds all `[Conditional:Key]` placeholders in the template.
- For each placeholder, it checks the corresponding column (`Key`) in the Excel file for that recipient.
- If the column's value is `1`, the placeholder is replaced with the text from `conditional_lines.json`.
- If the column's value is not `1` (or is empty), the placeholder is removed, leaving no empty space.

This method gives you precise control over the placement of each piece of conditional content.

### Multiple Recipients

You can send emails to multiple recipients by using comma-separated email addresses in the `Email` (or `To`), `CC`, and `BCC` columns:

**Example Excel data:**
| Email | CC | BCC | Subject | FirstName |
|-------|----|----|---------|-----------|
| john@example.com, jane@example.com | manager@example.com | hr@example.com | Welcome | John |
| alice@company.com | bob@company.com, charlie@company.com | | Meeting | Alice |

This will create emails with:
- **To**: Multiple primary recipients
- **CC**: Carbon copy recipients (visible to all)
- **BCC**: Blind carbon copy recipients (hidden from other recipients)

#### Manual Circuit Breaker

To quickly and temporarily disable an email address in the `To`, `CC`, or `BCC` fields without deleting it, you can wrap it in square brackets. The script will ignore any address formatted like `[user@example.com]`.

Additionally, a single open bracket `[` is appended by default to the end of the `CC` line in every generated email. This is a deliberate feature to act as a manual "circuit breaker." Most email clients will see this as an invalid address, preventing the email from being sent until a user manually reviews and removes the bracket. This helps prevent accidental bulk sending.

2. Run the generator:

```bash
python email_file_generator.py
```

Adjust the paths by editing the `main()` call at the bottom of `email_file_generator.py` or by modifying the default arguments.

The script prints progress information and produces one `.eml` file for each row in the spreadsheet.
